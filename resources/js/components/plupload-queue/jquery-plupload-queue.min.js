AWPCP.run("awpcp/plupload-queue-translation",["awpcp/settings"],function(a){plupload.addI18n(a.l10n("plupload-queue"))}),function(a,b){function c(a){return plupload.translate(a)||a}function d(b,d){d.contents().each(function(b,c){c=a(c),c.is(".plupload")||c.remove()}),d.prepend('<div class="plupload_wrapper plupload_scroll"><div id="'+b+'_container" class="plupload_container"><div class="plupload"><div class="plupload_header"><div class="plupload_header_content"><div class="plupload_header_title">'+c("Select files")+'</div><div class="plupload_header_text">'+c("Add files to the upload queue and click the start button.")+'</div></div></div><div class="plupload_content"><div class="plupload_filelist_header"><div class="plupload_file_name">'+c("Filename")+'</div><div class="plupload_file_action">&nbsp;</div><div class="plupload_file_status"><span>'+c("Status")+'</span></div><div class="plupload_file_size">'+c("Size")+'</div><div class="plupload_clearer">&nbsp;</div></div><ul id="'+b+'_filelist" class="plupload_filelist"></ul><div class="plupload_filelist_footer"><div class="plupload_file_name"><div class="plupload_buttons"><a href="#" class="plupload_button plupload_add" id="'+b+'_browse">'+c("Add Files")+'</a><a href="#" class="plupload_button plupload_start">'+c("Start Upload")+'</a></div><span class="plupload_upload_status"></span></div><div class="plupload_file_action"></div><div class="plupload_file_status"><span class="plupload_total_status">0%</span></div><div class="plupload_file_size"><span class="plupload_total_file_size">0 b</span></div><div class="plupload_progress"><div class="plupload_progress_container"><div class="plupload_progress_bar"></div></div></div><div class="plupload_clearer">&nbsp;</div></div></div></div></div><input type="hidden" id="'+b+'_count" name="'+b+'_count" value="0" /></div>')}var e={};a.fn.pluploadQueue=function(f){return f?(this.each(function(){function g(b){var c;b.status==plupload.DONE&&(c="plupload_done"),b.status==plupload.FAILED&&(c="plupload_failed"),b.status==plupload.QUEUED&&(c="plupload_delete"),b.status==plupload.UPLOADING&&(c="plupload_uploading");var d=a("#"+b.id).attr("class",c).find("a").css("display","block");b.hint&&d.attr("title",b.hint)}function h(){a("span.plupload_total_status",l).html(k.total.percent+"%"),a("div.plupload_progress_bar",l).css("width",k.total.percent+"%"),a("span.plupload_upload_status",l).html(b.sprintf(c("Uploaded %d/%d files"),k.total.uploaded,k.files.length))}function i(){var d,e=a("ul.plupload_filelist",l).html(""),f=0;a.each(k.files,function(b,c){d="",c.status==plupload.DONE&&(c.target_name&&(d+='<input type="hidden" name="'+m+"_"+f+'_tmpname" value="'+plupload.xmlEncode(c.target_name)+'" />'),d+='<input type="hidden" name="'+m+"_"+f+'_name" value="'+plupload.xmlEncode(c.name)+'" />',d+='<input type="hidden" name="'+m+"_"+f+'_status" value="'+(c.status==plupload.DONE?"done":"failed")+'" />',f++,a("#"+m+"_count").val(f)),e.append('<li id="'+c.id+'"><div class="plupload_file_name"><span>'+c.name+'</span></div><div class="plupload_file_action"><a href="#"></a></div><div class="plupload_file_status">'+c.percent+'%</div><div class="plupload_file_size">'+plupload.formatSize(c.size)+'</div><div class="plupload_clearer">&nbsp;</div>'+d+"</li>"),g(c),a("#"+c.id+".plupload_delete a").click(function(b){a("#"+c.id).remove(),k.removeFile(c),b.preventDefault()})}),a("span.plupload_total_file_size",l).html(plupload.formatSize(k.total.size)),a("span.plupload_add_text",l).html(0===k.total.queued?c("Add Files"):b.sprintf(c("%d files queued"),k.total.queued)),a("a.plupload_start",l).toggleClass("plupload_disabled",k.files.length==k.total.uploaded+k.total.failed),e[0].scrollTop=e[0].scrollHeight,h(),!k.files.length&&k.features.dragdrop&&k.settings.dragdrop&&a("#"+m+"_filelist").append('<li class="plupload_droptext">'+c("Drag files here.")+"</li>")}function j(){delete e[m],k.destroy(),l.html(n),k=l=n=null}var k,l,m,n;l=a(this),m=l.attr("id"),m||(m=plupload.guid(),l.attr("id",m)),n=l.html(),d(m,l),f=a.extend({dragdrop:!0,browse_button:m+"_browse",container:m},f),f.dragdrop&&(f.drop_element=m+"_filelist"),k=new plupload.Uploader(f),e[m]=k,k.bind("UploadFile",function(b,c){a("#"+c.id).addClass("plupload_current_file")}),k.bind("Init",function(b,c){!f.unique_names&&f.rename&&l.on("click","#"+m+"_filelist div.plupload_file_name span",function(c){var d,e,f,g=a(c.target),h="";d=b.getFile(g.parents("li")[0].id),f=d.name,e=/^(.+)(\.[^.]+)$/.exec(f),e&&(f=e[1],h=e[2]),g.hide().after('<input type="text" />'),g.next().val(f).focus().blur(function(){g.show().next().remove()}).keydown(function(b){var c=a(this);13==b.keyCode&&(b.preventDefault(),d.name=c.val()+h,g.html(d.name),c.blur())})}),a("#"+m+"_container").attr("title","Using runtime: "+c.runtime),a("a.plupload_start",l).click(function(b){a(this).hasClass("plupload_disabled")||k.start(),b.preventDefault()}),a("a.plupload_stop",l).click(function(a){a.preventDefault(),k.stop()}),a("a.plupload_start",l).addClass("plupload_disabled")}),k.bind("Error",function(b,d){var e,f=d.file;f&&(e=d.message,d.details&&(e+=" ("+d.details+")"),d.code==plupload.FILE_SIZE_ERROR&&alert(c("Error: File too large:")+" "+f.name),d.code==plupload.FILE_EXTENSION_ERROR&&alert(c("Error: Invalid file extension:")+" "+f.name),f.hint=e,a("#"+f.id).attr("class","plupload_failed").find("a").css("display","block").attr("title",e)),d.code===plupload.INIT_ERROR&&setTimeout(function(){j()},1)}),k.bind("PostInit",function(b){b.settings.dragdrop&&b.features.dragdrop&&a("#"+m+"_filelist").append('<li class="plupload_droptext">'+c("Drag files here.")+"</li>")}),k.init(),k.bind("StateChanged",function(){k.state===plupload.STARTED?(a("li.plupload_delete a,div.plupload_buttons",l).hide(),a("span.plupload_upload_status,div.plupload_progress,a.plupload_stop",l).css("display","block"),a("span.plupload_upload_status",l).html("Uploaded "+k.total.uploaded+"/"+k.files.length+" files"),f.multiple_queues&&a("span.plupload_total_status,span.plupload_total_file_size",l).show()):(i(),a("a.plupload_stop,div.plupload_progress",l).hide(),a("a.plupload_delete",l).css("display","block"),f.multiple_queues&&k.total.uploaded+k.total.failed==k.files.length&&(a(".plupload_buttons,.plupload_upload_status",l).css("display","inline"),a(".plupload_start",l).addClass("plupload_disabled"),a("span.plupload_total_status,span.plupload_total_file_size",l).hide()))}),k.bind("FilesAdded",i),k.bind("FilesRemoved",function(){var b=a("#"+m+"_filelist").scrollTop();i(),a("#"+m+"_filelist").scrollTop(b)}),k.bind("FileUploaded",function(a,b){g(b)}),k.bind("UploadProgress",function(b,c){a("#"+c.id+" div.plupload_file_status",l).html(c.percent+"%"),g(c),h()}),f.setup&&f.setup(k)}),this):e[a(this[0]).attr("id")]}}(jQuery,mOxie);