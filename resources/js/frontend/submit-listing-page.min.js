AWPCP.define("awpcp/frontend/order-section-controller",["jquery","awpcp/categories-selector","awpcp/user-selector","awpcp/payment-terms-list","awpcp/credit-plans-list","awpcp/jquery-userfield"],function(a,b,c,d,e){var f=function(a,b){var c=this;c.id=a.id,c.template=a.template,c.store=b};return a.extend(f.prototype,{render:function(a){var b=this;b.$element||(b.renderTemplate(a),b.updateInitialState()),b.updateTemplate()},renderTemplate:function(f){var g=this;g.$element=a(g.template),f.append(g.$element),g.$editModeContainer=a(".awpcp-order-submit-listing-section__edit_mode"),g.$readModeContainer=a(".awpcp-order-submit-listing-section__read_mode"),g.$listOfSelectedCategories=a(".awpcp-order-submit-listing-section--selected-categories"),g.$listingOwner=a(".awpcp-order-submit-listing-section--listing-owner"),g.$paymentTerm=a(".awpcp-order-submit-listing-section--payment-term"),g.$creditPlanLabel=a(".awpcp-order-submit-listing-section--credit-plan-label"),g.$creditPlan=a(".awpcp-order-submit-listing-section--credit-plan"),g.paymentTermsList=new d(f.find(".awpcp-payment-terms-list"),{onChange:function(a){g.store.updateSelectedPaymentTerm(a)}}),g.categoriesSelector=new b(f.find(".awpcp-category-dropdown"),{onChange:function(a){g.store.updateSelectedCategories(a)}});var h=f.find(".awpcp-user-selector"),i=a.extend(h.data("configuration"),{onChange:function(a){g.store.updateSelectedUser(a)}});g.userSelector=new c(h,i),g.creditPlansList=new e(f.find(".awpcp-credit-plans-table"),{onChange:function(a){g.store.updateSelectedCreditPlan(a)}}),f.on("click",".awpcp-order-submit-listing-section--continue-button",function(a){a.preventDefault(),g.onContinueButtonClicked()}),f.on("click",".awpcp-order-submit-listing-section--change-selection-button",function(a){a.preventDefault(),g.onChangeSelectionButtonClicked()})},updateInitialState:function(){var a=this;a.store.updateSelectedPaymentTerm(a.paymentTermsList.getSelectedPaymentTerm()),a.store.updateSelectedCategories(a.categoriesSelector.getSelectedCategories()),a.store.updateSelectedUser(a.userSelector.getSelectedUser())},updateTemplate:function(){var a=this;return"read"===a.store.getSectionState(a.id)?void a.updateReadModeTemplate():void a.updateEditModeTemplate()},updateReadModeTemplate:function(){var b=this;b.$editModeContainer.hide(),b.$readModeContainer.show(),b.$listOfSelectedCategories.empty().text(b.store.getSelectedCategoriesNames().join(", ")),b.$listingOwner.find("span").html(b.store.getSelectedUserName()),b.$paymentTerm.hide(),b.$creditPlan.hide();var c=b.store.getSelectedPaymentTerm();c&&(b.$paymentTerm.html(a('[data-id="'+c.type+"-"+c.id+'"]').html()).show(),b.$paymentTerm.find("input").prop("disabled",!0),b.$paymentTerm.find("label").hide(),b.$paymentTerm.find(".awpcp-payment-term-price-in-"+c.mode).show());var d=b.store.getSelectedCreditPlanSummary();d&&b.$creditPlan.show().find("span").html(d)},updateEditModeTemplate:function(){var a=this;a.$readModeContainer.hide(),a.$editModeContainer.show()},onContinueButtonClicked:function(){var a=this;a.store.setSectionStateToRead(a.id)},onChangeSelectionButtonClicked:function(){var a=this;a.store.setSectionStateToEdit(a.id)}}),f}),AWPCP.define("awpcp/frontend/submit-listing-data-store",["jquery"],function(a){var b=function(a){this.data=a||{}};return a.extend(b.prototype,{setSectionStateToRead:function(a){var b=this;b.setSectionState(a,"read")},setSectionState:function(a,b){var c=this;"undefined"==typeof c.data.sections&&(c.data.sections={}),"undefined"==typeof c.data.sections[a]&&(c.data.sections[a]={}),c.data.sections[a].state=b,c.refresh()},setSectionStateToEdit:function(a){var b=this;b.setSectionState(a,"edit")},refresh:function(){var a=this;a.listener.render(),console.log(a.data)},getSectionState:function(a){var b=this;return b.data.sections&&b.data.sections[a]&&b.data.sections[a].state?b.data.sections[a].state:"edit"},updateSelectedCategories:function(a){var b=this;b.data.categories=a,b.refresh()},getSelectedCategoriesNames:function(){var b=this;return a.map(b.data.categories||[],function(a){return a.name})},updateSelectedUser:function(a){var b=this;b.data.user=a,b.refresh()},getSelectedUserName:function(){var a=this;return a.data.user?a.data.user.name:""},updateSelectedPaymentTerm:function(a){var b=this;b.data.paymentTerm=a,b.refresh()},getSelectedPaymentTerm:function(){var a=this;return a.data.paymentTerm?a.data.paymentTerm:null},getSelectedPaymentTermSummary:function(){var a=this;return a.data.paymentTerm?a.data.paymentTerm.summary:""},updateSelectedCreditPlan:function(a){var b=this;b.data.creditPlan=a,b.refresh()},getSelectedCreditPlanSummary:function(){var a=this;return a.data.creditPlan?a.data.creditPlan.summary:""}}),b}),AWPCP.run("awpcp/frontend/submit-listing-page",["jquery","awpcp/frontend/submit-listing-data-store","awpcp/frontend/order-section-controller"],function(a,b,c){var d=function(a,b,c){var d=this;d.store=a,d.sections=b,d.$container=c};a.extend(d.prototype,{render:function(){var b=this;a.each(b.sections,function(a,c){c.render(b.$container)})}});var e=new b,f={OrderSection:new c(AWPCPSubmitListingPageSections[0],e)},g=new d(e,f,a(".awpcp-submit-listing-page-form"));e.listener=g,e.refresh()});