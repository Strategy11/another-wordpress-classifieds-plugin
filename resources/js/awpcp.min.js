function AWPCPError(a){this.name="AWPCPError",this.message=a||"AWPCP Error."}!function(a){var b=a({});a.subscribe=function(){b.bind.apply(b,arguments)},a.unsubscribe=function(){b.unbind.apply(b,arguments)},a.publish=function(){b.trigger.apply(b,arguments)}}(jQuery),function(a){var b=function(){"object"==typeof __awpcp_js_data?this.options=__awpcp_js_data:this.options={},"object"==typeof __awpcp_js_l10n?this.localization=__awpcp_js_l10n:this.localization={},null===this.get("ajaxurl")&&("undefined"!=typeof b&&b.ajaxurl?this.set("ajaxurl",b.ajaxurl):"undefined"!=typeof ajaxurl?this.set("ajaxurl",ajaxurl):this.set("ajaxurl","/wp-admin/admin-ajax.php"))};a.extend(b.prototype,{set:function(a,b){return this.options[a]=b,this},get:function(a,b){return this.options[a]?this.options[a]:b?b:null},l10n:function(a,b){if(this.localization.hasOwnProperty(a)){if(!b)return this.localization[a];if(b&&this.localization[a].hasOwnProperty(b))return this.localization[a][b]}return""},validate:function(b){a.extend(a.validator.messages,a.AWPCP.get("default-validation-messages")),a.validator.addMethod("money",function(){var b=a.AWPCP.get("decimal-separator"),c=a.AWPCP.get("thousands-separator"),d=new RegExp("^-?(?:\\d+|\\d{1,3}(?:\\"+c+"\\d{3})+)?(?:\\"+b+"\\d+)?$");return function(a,b){return this.optional(b)||d.test(a)}}()),a.validator.addClassRules("integer",{integer:!0}),a.validator.setDefaults(b||{errorClass:"invalid",errorElement:"span",errorPlacement:function(b,c){b.addClass("awpcp-error");var d=["payment_term","credit_plan","payment_method"];-1!==a.inArray(c.attr("name"),d)?b.insertBefore(c.closest("table")):c.closest(".awpcp-form-spacer").length&&b.appendTo(c.closest(".awpcp-form-spacer"))}})}}),a.AWPCP=new b,a.AWPCP.PaginationForm=function(b){this.form=a(b),this.form.find("select").change(function(){this.form.submit()})},a.AWPCP.MainMenu=function(b){var c=this;c.container=a(b),c.toggle=c.container.find(".awpcp-menu-toggle"),c.toggle.click(function(){c.container.toggleClass("toggle-on")})},a(function(){a(".awpcp-pagination-form").each(function(){a.noop(new a.AWPCP.PaginationForm(this))}),a(".awpcp-navigation").each(function(){a.noop(new a.AWPCP.MainMenu(a(this)))})})}(jQuery),AWPCPError.prototype=new Error,AWPCPError.prototype.constructor=AWPCPError;var AWPCP=function(){function a(a,b,c){h[a]={dependencies:b,handler:c}}function b(b,d,e){a(b,d,e),c(b)}function c(a){try{d(a)}catch(b){if(!(b instanceof AWPCPError))throw b;g("AWPCP: "+b.message)}}function d(a){var b=h[a];if(i[a])return i[a];if(void 0===b)throw new AWPCPError("Dependency ["+a+"] not found.");for(var c=[],e=b.dependencies.length-1;e>=0;e-=1)c.unshift(d(b.dependencies[e]));return i[a]=b.handler.apply(null,c),i[a]}function e(a,b){return console&&console[a]&&console[a].apply&&console[a].apply(console,b)}function f(){return e("log",arguments)}function g(){return e("error",arguments)}var h={},i={};return{instantiate:c,define:a,run:b,log:f,error:g}};AWPCP=new AWPCP(window),AWPCP.define("jquery",[],function(){return jQuery}),AWPCP.define("knockout",[],function(){return ko}),AWPCP.define("moment",[],function(){return moment}),AWPCP.define("awpcp/category-dropdown",["jquery"],function(a){a.AWPCP.CategoriesDropdown=function(b,c){function d(){var b=parseInt(f.dropdown.val(),10);a.publish("/category/updated",[f.dropdown,isNaN(b)?null:b])}var e,f=this;f.hidden=a(b),f.dropdown=a(c),f.hidden.length>0?(f.identifier=f.dropdown.attr("target"),f.category_id=parseInt(f.dropdown.val(),10),f.widget=new a.AWPCP.CategoriesDropdownWidget(f.identifier,f.dropdown,null,f.category_id),a.subscribe("/category/updated/"+f.identifier,function(a,b){f.hidden.val(b)}),e=f.dropdown.attr("chain"),e&&e.length>0?(e=a.map(e.split(","),function(a){return parseInt(a,10)}),f.widget.choose(e)):setTimeout(function(){f.widget.change(null)},100)):(f.dropdown.change(d),setTimeout(d,100))},a.AWPCP.CategoriesDropdownWidget=function(b,c,d,e){var f=this;if(f.identifier=b,f.category_id=e,f.parent=d,f.child=null,!c&&d)f.default_option=f.parent.attr("next-default-option"),f.dropdown=a('<select class="awpcp-category-dropdown">').insertAfter(d).hide();else{if(!c)return;f.dropdown=c}f.dropdown.change(function(){f.change(parseInt(a(this).val(),10))}),a.subscribe("/category/widget/updated/"+f.identifier,function(a,b,c){f.parent===b&&f.render(c)}),f.dropdown.val(f.category?f.category:"")},a.extend(a.AWPCP.CategoriesDropdownWidget.prototype,{change:function(b){var c=this;c.category_id=isNaN(b)?null:b,null===c.child&&(c.child=new a.AWPCP.CategoriesDropdownWidget(c.identifier,null,c.dropdown,null)),a.publish("/category/updated",[c.dropdown,c.category_id]),a.publish("/category/updated/"+c.identifier,[c.category_id]),a.publish("/category/widget/updated/"+c.identifier,[c.dropdown,c.category_id])},render:function(b){var c,d,e,f=this;d=a.AWPCP.get("categories")||window["categories_"+f.identifier],c=null===f.parent&&d.hasOwnProperty("root")?d.root:d.hasOwnProperty(b)?d[b]:[],f.dropdown.empty().append(a('<option value="">'+f.default_option+"</option>")),e=c.length;for(var g=0;e>g;g+=1)f.dropdown.append(a('<option value="'+c[g].term_id+'">'+c[g].name+"</option>"));e>0?f.dropdown.show():f.hide()},choose:function(a){var b=this;a.length>0&&(b.dropdown.val(a[0]),b.change(a[0]),b.child.choose(a.slice(1)))},hide:function(){this.dropdown.hide()}}),a.fn.categorydropdown=function(){a(this).each(function(){var b=a(this),c=a("#awpcp-category-dropdown-"+b.attr("target"));a.noop(new a.AWPCP.CategoriesDropdown(c,b))})}}),AWPCP.define("awpcp/available-categories-list-view",["awpcp/categories-list-view"],function(a){var b=a.extend({_getEnabledCategories:function(a){return this.helper.getCategoriesThatCanBeSelectedTogether(a)}});return b}),AWPCP.define("awpcp/categories-list-view",["jquery","awpcp/category-item-view"],function(a,b){var c=Backbone.View.extend({tagName:"div",className:"awpcp-categories-selector-categories-list",initialize:function(a){this.title=a.title,this.helper=a.helper},render:function(){this.$el.html(this._getTemplate());var a=this.collection.map(function(a){return a.id}),b=this.$(".awpcp-categories-selector-categories-list-items").empty();return a.length?this._renderCategoriesList(b,a):this._renderEmptyList(b)},_getTemplate:function(){var a="";return a+='<div class="awpcp-categories-selector-categories-list-title">'+this.title+"</div>",a+='<ul class="awpcp-categories-selector-categories-list-items"></ul>'},_renderCategoriesList:function(a,b){var c=this.helper.getCategoriesAncestors(b),d=this._getEnabledCategories(b);return this._renderCategoryItems(a,this.helper.getCategoryChildren("root"),d,c,0),this},_getEnabledCategories:function(a){return a},_renderCategoryItems:function(a,b,c,d,e){var f=this;_.each(b,function(b){-1!==d.indexOf(b.get("id"))&&(a.append(f._renderCategoryItem(f.helper.getCategory(b.get("id")),c,e)),f._renderCategoryItems(a,f.helper.getCategoryChildren(b.get("id")),c,d,e+1))})},_renderCategoryItem:function(a,c,d){var e=new b({model:a,indentationLevel:d,isEnabled:-1!==c.indexOf(a.get("id")),showPriceField:this.showPriceField});return e.render().$el},_renderEmptyList:function(b){return b.append(a('<li class="awpcp-categories-selector-category-item awpcp-categories-selector-empty-category-item">No categories to show.</li>')),this}});return c}),AWPCP.define("awpcp/categories-selector-helper",["jquery","awpcp/category-item-model"],function(a,b){var c=function(a,c){var d,e,f=this;this.all=[],this.selectedCategories=[],this.registry={},this.hierarchy={},this.parents={},this.selectionMatrix=c,_.each(_.keys(a),function(c){d="root"==c?c:parseInt(c,10),f.hierarchy[d]=_.map(a[c],function(a){return e=new b({id:a.term_id,name:a.name,price:a.price,selected:!1}),f.all.push(e),f.registry[a.term_id]=e,f.parents[a.term_id]=d,e})})};return a.extend(c.prototype,{getAllCategories:function(){return this.all},getCategoriesAncestors:function(a){for(var b,c=[],d=0;d<a.length;d++){b=a[d];do-1===c.indexOf(b)&&c.push(b),b=this.getCategoryParent(b);while(b&&"root"!=b)}return c},getCategory:function(a){return this.registry[a]},getCategoryParent:function(a){return this.parents[a]},getCategoryChildren:function(a){return"undefined"!=typeof this.hierarchy[a]?this.hierarchy[a]:[]},updateSelectedCategories:function(a){this.selectedCategories=a},getCategoriesThatCanBeSelectedTogether:function(a){var b=this;return null===b.selectionMatrix?a:0===b.selectedCategories.length?_.map(_.keys(b.selectionMatrix),function(a){return parseInt(a,10)}):1===b.selectedCategories.length?b.getCategoriesThatCanBeCombinedWithCategory(b.selectedCategories[0]):_.reduce(b.selectedCategories,function(a,c){return _.intersection(a,b.getCategoriesThatCanBeCombinedWithCategory(c))},a)},getCategoriesThatCanBeCombinedWithCategory:function(a){return this.selectionMatrix[a]?this.selectionMatrix[a]:[]}}),c}),AWPCP.define("awpcp/categories-selector-view",["jquery","awpcp/categories-collection","awpcp/categories-list-view","awpcp/available-categories-list-view"],function(a,b,c,d){var e=Backbone.View.extend({initialize:function(a){var b=this;this.helper=a.helper,this.fieldName=a.fieldName,this.listenTo(this.collection,"change:selected",function(){b.updateSelectedCategories(),b.render()})},render:function(){var e,f=this,g=this.$el,h=this.$(".awpcp-categories-selector-categories-lists").empty(),i=this.getSelectedCategories();return this.$(".awpcp-categories-selector-hidden-values").remove(),_.each(i,function(b){g.append(a('<input class="awpcp-categories-selector-hidden-values" type="hidden" name="'+f.fieldName+'[]" value="'+b.id+'">'))}),e=new c({collection:new b(i),title:"Selected Categories",helper:this.helper}),h.append(e.render().$el),e=new d({collection:new b(this.collection.filter(function(a){return a.get("selected")?!1:!0})),title:"Available Categories",helper:this.helper}),h.append(e.render().$el),this},updateSelectedCategories:function(){var a=this.getSelectedCategories().map(function(a){return a.get("id")});this.publishSelectedCategories(a),this.helper.updateSelectedCategories(a)},getSelectedCategories:function(){return this.collection.filter(function(a){return a.get("selected")?!0:!1})},publishSelectedCategories:function(b){a.publish("/category/updated",[a(this.el),b])}});return e}),AWPCP.define("awpcp/category-item-view",[],function(){var a=Backbone.View.extend({tagName:"li",className:"awpcp-categories-selector-category-item",events:{"click .awpcp-categories-selctor-category-action":"sendButtonAction"},initialize:function(a){this.template=this._getItemTemplate(),this.indentationLevel=a.indentationLevel,this.isEnabled=a.isEnabled,this.isEnabled||this.$el.addClass("awpcp-categories-selector-category-item-disabled")},render:function(){return this.$el.html(this.template({category:{name:"&mdash;&nbsp;".repeat(this.indentationLevel)+this.model.get("name")},action:this.model.get("selected")?"Remove Category":"Add Category",showPriceField:this.showPriceField})),this},_getItemTemplate:function(){var a="";return a+='<span class="awpcp-categories-selector-category-item-name">',a+="<%= category.name %>",a+="</span>",a+='<span class="awpcp-align-text-right">',this.showPriceField&&(a+='<label class="awpcp-categories-selector-category-item-price-field">',a+="<span>$</span>",a+="<input />",a+="</label>"),a+='<a class="awpcp-categories-selctor-category-action" href="#" ><%= action %></a>',a+="</span>",_.template(a)},sendButtonAction:function(a){a.preventDefault(),this.model.set({selected:this.model.get("selected")?!1:!0})}});return a}),AWPCP.define("awpcp/categories-collection",[],function(){var a=Backbone.Collection.extend({});return a}),AWPCP.define("awpcp/category-item-model",[],function(){var a=Backbone.Model.extend({defaults:{id:0,name:"Default Category",price:0,selected:!1}});return a}),AWPCP.define("awpcp/datepicker-field",["jquery","awpcp/settings"],function(a,b){var c=function(c){var d,e=this;e.element=a(c),d=a.extend({},b.l10n("datepicker"),{dateFormat:b.get("date-format"),altField:e.element,altFormat:"yy/mm/dd"}),e.element.parent().find("[datepicker-placeholder]").datepicker(d)};return c}),AWPCP.define("awpcp/file-manager",["jquery","knockout","awpcp/file","awpcp/settings"],function(a,b,c,d){var e=function(c,e,f){var g=this;g.files=b.observableArray([]),g.images=b.observableArray([]),g.attachments=b.observableArray([]),g.imagesAllowed=b.observable(f.imagesAllowed),g.imagesUploaded=b.observable(f.imagesUploaded),g.primaryImageId=b.observable(f.primaryImageId),g.setImageAsPrimary=function(b){g.showLoadingSpinner(b),a.post(d.get("ajaxurl"),{nonce:c,action:"awpcp-set-image-as-primary",listing_id:b.listing_id,file_id:b.id},function(a){"ok"===a.status&&(g.primaryImageId(b.id),g.hideLoadingSpinner(b))})},g.showLoadingSpinner=function(b){a("#file-"+b.id).find(".image-actions .spinner").removeClass("spinner-hidden")},g.hideLoadingSpinner=function(b){a("#file-"+b.id).find(".image-actions .spinner").addClass("spinner-hidden")},g.updateFileEnabledStatus=function(b){var e=this;e.locked||(g.showLoadingSpinner(e),e.locked=!0,a.post(d.get("ajaxurl"),{nonce:c,action:"awpcp-update-file-enabled-status",listing_id:e.listing_id,file_id:e.id,new_status:b},function(a){"ok"!==a.status&&e.enabled(!b),g.hideLoadingSpinner(e),e.locked=!1}))},g.deleteFile=function(b){g.showLoadingSpinner(b),a.post(d.get("ajaxurl"),{nonce:c,action:"awpcp-delete-file",listing_id:b.listing_id,file_id:b.id},function(a){"ok"===a.status&&(g.files.remove(b),b.isImage?g.images.remove(b):g.attachments.remove(b),g.hideLoadingSpinner(b))})},g.prepareFiles(c,e),g.defineComputedProperties()};return a.extend(e.prototype,{prepareFiles:function(b,d){var e=this;a.each(d,function(a,b){var d=new c(b,e.primaryImageId);d.enabled.subscribe(e.updateFileEnabledStatus,d),e[b.isImage?"images":"attachments"].push(d),e.files.push(d)})},defineComputedProperties:function(){var a=this;a.haveFiles=b.computed(function(){return a.files().length>0}),a.haveImages=b.computed(function(){return a.images().length>0}),a.haveAttachments=b.computed(function(){return a.attachments().length>0}),a.canUploadImages=b.computed(function(){return a.imagesAllowed()>a.images().length})}}),e}),AWPCP.define("awpcp/file",["knockout"],function(a){var b=function(b,c){var d=this;d.id=b.id,d.name=b.name,d.listing_id=b.listing_id,d.thumbnailUrl=b.thumbnailUrl,d.iconUrl=b.iconUrl,d.url=b.url,d.enabled=a.observable(parseInt(b.enabled,10)),d.isImage=b.isImage,d.status=a.observable(b.status),d.isPrimaryImage=a.computed(function(){return c()===d.id}),d.getFileClasses=a.computed(function(){var a=[];return d.isPrimaryImage()&&a.push("primary-image"),a.push(d.enabled()?"enabled":"disabled"),a.push(d.status().toLowerCase()),a.join(" ")}),d.getFileId=a.computed(function(){return"file-"+d.id})};return b}),AWPCP.define("awpcp/file-view-model",["knockout"],function(a){var b=function(b){function c(){return"Approved"===g.status()}function d(){return"Rejected"===g.status()}function e(){return"Awaiting-Approval"===g.status()}function f(){return null!==g.progress()}var g=this;g.id=b.id,g.name=b.name,g.listingId=b.listingId,g.mimeType=b.mimeType,g.enabled=a.observable(!!parseInt(b.enabled,10)),g.status=a.observable(b.status),g.isPrimary=a.observable(!!b.isPrimary),g.isApproved=a.computed(c),g.isRejected=a.computed(d),g.isAwaitingApproval=a.computed(e),g.isBeingModified=a.observable(!1),g.thumbnailUrl=a.observable(b.thumbnailUrl),g.iconUrl=b.iconUrl,g.url=b.url,g.progress=a.observable(b.progress?parseInt(b.progress,10):null),g.shouldShowProgressBar=a.computed(f)};return b}),AWPCP.define("awpcp/media-manager",["jquery","knockout","awpcp/file-view-model","awpcp/settings"],function(a,b,c,d){var e=function(e){function f(b){return a.map(b,function(a){var b=new c(a);return b.enabled.subscribe(q,b),b})}function g(){return h("images")}function h(a){return e.allowed_files[a]&&e.allowed_files[a].hasOwnProperty("mime_types")?i(B.files(),e.allowed_files[a].mime_types):[]}function i(b,c){return a.grep(b,function(b){return-1!==a.inArray(b.mimeType,c)})}function j(){return h("videos")}function k(){return h("others")}function l(){return B.images().length>0}function m(){return B.videos().length>0}function n(){return B.others().length>0}function o(b){b.isBeingModified(!0),a.post(d.get("ajaxurl"),{nonce:e.nonce,action:"awpcp-set-file-as-primary",listing_id:b.listingId,file_id:b.id},function(c){"ok"===c.status&&(a.each(p(b),function(a,b){b.isPrimary(!1)}),b.isPrimary(!0),b.isBeingModified(!1))})}function p(b){var c=null;return a.each(e.allowed_files,function(d,e){return-1!==a.inArray(b.mimeType,e.mime_types)?(c=e.mime_types,!1):void 0}),null===c?[]:i(B.files(),c)}function q(b){var c=this;c.isBeingModified()||(c.isBeingModified(!0),a.post(d.get("ajaxurl"),{nonce:e.nonce,action:"awpcp-update-file-enabled-status",listing_id:c.listingId,file_id:c.id,new_status:b},function(a){"ok"!==a.status&&c.enabled(!b),c.isBeingModified(!1)}))}function r(b){b.isBeingModified(!0),a.post(d.get("ajaxurl"),{nonce:e.nonce,action:"awpcp-delete-file",listing_id:b.listingId,file_id:b.id},function(c){"ok"===c.status&&(a.publish("/file/deleted",{type:b.mimeType}),B.files.remove(b),b.isBeingModified(!1))})}function s(b){b.isBeingModified(!0),a.post(d.get("ajaxurl"),{nonce:e.nonce,action:"awpcp-approve-file",listing_id:b.listingId,file_id:b.id},function(a){"ok"===a.status&&(b.status("Approved"),b.isBeingModified(!1))})}function t(b){b.isBeingModified(!0),a.post(d.get("ajaxurl"),{nonce:e.nonce,action:"awpcp-reject-file",listing_id:b.listingId,file_id:b.id},function(a){"ok"===a.status&&(b.status("Rejected"),b.isBeingModified(!1))})}function u(a){var b=["awpcp-uploaded-file"];return b.push(a.enabled()?"is-enabled":"is-disabled"),b.push("is-"+a.status().toLowerCase()),a.isPrimary()&&b.push("is-primary"),b.join(" ")}function v(a){return"file-"+a.id}function w(a,b){B.files.push(new c({id:b.id,name:b.name,mimeType:b.type,status:"Approved",progress:b.percent}))}function x(b,c,d){a.each(B.files(),function(a,b){b.id===d.id&&b.progress(d.percent)})}function y(b,d,e){var f=null;a.each(B.files(),function(a,b){b.id===d.id&&(f=a)}),null!=f?B.files.splice(f,1,new c(e)):B.files.push(new c(e))}function z(b,c){var d=null;a.each(B.files(),function(a,b){b.id===c.id&&(d=a)}),null!=d&&B.files.splice(d,1)}function A(b,c,d,e){a.each(B.files(),function(a,b){b.id===d.id&&b.thumbnailUrl(e)})}var B=this;B.files=b.observableArray(f(e.files)),B.images=b.computed(g),B.videos=b.computed(j),B.others=b.computed(k),B.haveImages=b.computed(l),B.haveVideos=b.computed(m),B.haveOtherFiles=b.computed(n),B.showAdminActions=b.observable(!!e.show_admin_actions),B.deleteFile=r,B.setFileAsPrimary=o,B.approveFile=s,B.rejectFile=t,B.getFileCSSClasses=u,B.getFileId=v,a.subscribe("/file/added",w),a.subscribe("/file/uploaded",y),a.subscribe("/file/progress",x),a.subscribe("/file/failed",z),a.subscribe("/file/thumbnail-updated",A)};return e}),AWPCP.define("awpcp/listings-media-uploader-view",["jquery","awpcp/media-uploader-view","awpcp/settings"],function(a,b,c){var d=b.extend({initialize:function(){var a=this;a._super("initialize"),a.listenTo(a.model,"media-uploader:file-uploaded",_.bind(a.updateUploadRestrictionsMessage,a)),a.listenTo(a.model,"media-uploader:file-deleted",_.bind(a.updateUploadRestrictionsMessage,a)),a.configureBeforeUnloadEventHandler(),a.updateUploadRestrictionsMessage()},configureBeforeUnloadEventHandler:function(){var a=this;window.onbeforeunload=function(){return a.model.uploader?a.model.uploader.state===plupload.STARTED?c.l10n("media-uploader-beforeunload","files-are-being-uploaded"):a.model.uploader.total.queued>0?c.l10n("media-uploader-beforeunload","files-pending-to-be-uploaded"):0===a.model.uploader.total.uploaded&&c.get("show-popup-if-user-did-not-upload-files")?c.l10n("media-uploader-beforeunload","no-files-were-uploaded"):void 0:!1}},updateUploadRestrictionsMessage:function(){this.$restrictions.html(this.model.buildUploadRestrictionsMessage())}});return d}),Backbone.View.prototype._super=function(a){return this.constructor.__super__[a].apply(this,_.rest(arguments))},AWPCP.define("awpcp/media-uploader-view",["jquery"],function(){var a=Backbone.View.extend({initialize:function(){var a=this.render();a.$dropzone=a.$(".awpcp-media-uploader-dropzone"),a.$browseButton=a.$(".awpcp-media-uploader-browser-button"),a.$restrictions=a.$(".awpcp-media-uploader-restrictions"),a.$dropzone.on("dragover",_.bind(a.onDragOver,a)),a.$dropzone.on("dragleave",_.bind(a.onDragLeave,a)),a.$dropzone.on("drop",_.bind(a.onDragStop,a)),a.model.prepareUploader(a.$el,a.$dropzone,a.$browseButton)},render:function(){var a=this;return a},onDragOver:function(){this.$dropzone.addClass("awpcp-media-uploader-dropzone-active")},onDragLeave:function(){this.$dropzone.removeClass("awpcp-media-uploader-dropzone-active")},onDragStop:function(){this.$dropzone.removeClass("awpcp-media-uploader-dropzone-active")}});return a}),AWPCP.define("awpcp/media-uploader",["jquery","awpcp/settings"],function(a,b){var c=Backbone.Model.extend({initialize:function(){a.subscribe("/file/deleted",_.bind(this.onFileDeleted,this))},prepareUploader:function(a,c,d){var e=this;plupload.addFileFilter("restrict_file_size",_.bind(e.filterFileBySize,e)),plupload.addFileFilter("restrict_file_count",_.bind(e.filterFileByCount,e)),e.uploader=new plupload.Uploader({browse_button:d.get(0),url:b.get("ajaxurl"),container:a.get(0),drop_element:c.get(0),filters:{mime_types:_.bind(e.getFileTypeFilters,e),restrict_file_size:!0,restrict_file_count:!0},multipart_params:{action:"awpcp-upload-listing-media",listing:e.get("settings").listing_id,nonce:e.get("settings").nonce},multi_selection:!1,chunk_size:"10000000",runtimes:"html5,flash,silverlight,html4",flash_swf_url:e.get("settings").flash_swf_url,silverlight_xap_url:e.get("settings").silverlight_xap_url}),e.uploader.init(),e.uploader.bind("FilesAdded",e.onFilesAdded,e),e.uploader.bind("UploadProgress",e.onUploadProgress,e),e.uploader.bind("FileUploaded",e.onFileUplaoded,e)},filterFileBySize:function(c,d,e){var f,g=this,h=g.getFileGroup(d);return null===h?e(!1):d.size>h.max_file_size?(f=b.l10n("media-uploader-strings","file-is-too-large"),f=f.replace("<filename>","<strong>"+d.name+"</strong>"),f=f.replace("<bytes-count>","<strong>"+h.max_file_size+"</strong>"),a.publish("/messages/media-uploader",{type:"error",content:f}),e(!1)):e(!0)},getFileGroup:function(b){var c=this,d=null;return a.each(c.get("settings").allowed_files,function(c,e){return-1!==a.inArray(b.type,e.mime_types)?(d=e,!1):void 0}),d},filterFileByCount:function(c,d,e){var f,g=this,h=g.getFileGroup(d);return null===h?e(!1):h.uploaded_file_count>=h.allowed_file_count?(f=b.l10n("media-uploader-strings","cannot-add-more-files"),f=f.replace("<filename>","<strong>"+d.name+"</strong>"),a.publish("/messages/media-uploader",{type:"error",content:f}),e(!1)):(h.uploaded_file_count=h.uploaded_file_count+1,e(!0))},getFileTypeFilters:function(){var b=this;return a.map(b.get("settings").allowed_files,function(a,b){return{title:b.substr(0,1).toUpperCase()+b.substr(1),extensions:a.extensions.join(",")}})},onFilesAdded:function(b,c){a.each(c,function(b,c){a.publish("/file/added",c)}),b.start()},onUploadProgress:function(b,c){a.publish("/file/progress",[b,c])},onFileUplaoded:function(b,c,d){var e=a.parseJSON(d.response);"ok"===e.status&&e.file?a.publish("/file/uploaded",[c,e.file]):"ok"!==e.status&&(this.decreaseFileCountInGroup(c),c.status=plupload.FAILED,this.uploader.trigger("UploadProgress",c),a.publish("/file/failed",c),a.publish("/messages/media-uploader",{type:"error",content:e.errors.join(" ")})),this.trigger("media-uploader:file-uploaded")},onFileDeleted:function(a,b){this.decreaseFileCountInGroup(b),this.trigger("media-uploader:file-deleted")},decreaseFileCountInGroup:function(a){var b=this.getFileGroup(a);null!==b&&(b.uploaded_file_count=b.uploaded_file_count-1)},buildUploadRestrictionsMessage:function(){var c=this,d="",e=[],f={},g=0,h=0;return b.l10n("media-uploader-strings","upload-restrictions"),a.each(c.get("settings").allowed_files,function(a,b){g=b.allowed_file_count-b.uploaded_file_count,g>0&&(e.push(a),h=b.max_file_size/1e6,h=Math.round(10*h)/10,f["<"+a+"-left>"]="<strong>"+g+"</strong>",f["<"+a+"-max-file-size>"]="<strong>"+h+" MB</strong>")}),d=b.l10n("media-uploader-strings","upload-restrictions-"+e.sort().join("-")),a.each(f,function(a,b){d=d.replace(a,b)}),d}});return c}),AWPCP.define("awpcp/media-center",["jquery","knockout","awpcp/media-manager","awpcp/media-uploader","awpcp/listings-media-uploader-view","awpcp/thumbnails-generator","awpcp/jquery-messages"],function(a,b,c,d,e,f){var g=function(g,h){var i=this;i.container=a(g);var j=i.container.find(".awpcp-media-manager"),k=i.container.find("#awpcp-media-uploader"),l=i.container.find(".awpcp-thumbnails-generator");if(i.container.find(".awpcp-messages").AWPCPMessages(),j.length&&h.mediaManagerOptions&&b.applyBindings(new c(h.mediaManagerOptions),j.get(0)),k.length&&h.mediaUploaderOptions){var m=new d({settings:h.mediaUploaderOptions});a.noop(new e({el:k,model:m}))}l.length&&a.noop(new f(l))};return a.fn.StartMediaCenter=function(b){a(this).each(function(){a.noop(new g(a(this),b))})},g}),AWPCP.define("awpcp/jquery-messages",["jquery","knockout","awpcp/messages","awpcp/settings"],function(a,b,c,d){a.fn.AWPCPMessages=function(){return a(this).each(function(){var e=d.get("messages-data-for-"+a(this).attr("data-component-id"));b.applyBindings(new c(e),a(this).get(0))})}}),AWPCP.define("awpcp/messages",["jquery","knockout"],function(a,b){var c=function(c){function d(a,b){f.messages.push(b),e()}function e(){setTimeout(function(){var a=f.messages().length;a>10&&f.messages.splice(0,a-10)},2e4)}var f=this;f.messages=b.observableArray([]),a.each(c.channels,function(b,c){a.subscribe("/messages/"+c,d)})};return c}),AWPCP.define("awpcp/multiple-region-selector-validator",["jquery"],function(a){var b=function(){};return a.extend(b.prototype,{showErrorsIfUserSelectedDuplicatedRegions:function(b){var c=this,d=a(b),e=c.getMultipleRegionSelectorInstance(d),f=!1;return"undefined"==typeof e?!1:(d.find(".multiple-region:visible").each(function(){e.checkDuplicatedRegionsForField(a(this).attr("id"),!0)&&(f=!0)}),f)},getMultipleRegionSelectorInstance:function(a){return a.find(".awpcp-multiple-region-selector").data("RegionSelector")},showErrorsIfRequiredFieldsAreEmpty:function(b){var c=a(b),d=this.getMultipleRegionSelectorInstance(c),e=null,f=!1;return a.each(d.regions(),function(b,c){a.each(c.partials(),function(a,b){if(b.config.required){var d=b.selected();(void 0===d||d.length&&0===d.length)&&(c.error(AWPCP.l10n("multiple-region-selector","missing-"+b.type)),e=e?e:b,f=!0)}})}),e&&c.find('[id="'+e.id+'"]').closest(".awpcp-region-selector-partials").find(":input:visible").last().focus(),f}}),new b}),AWPCP.define("awpcp/payment-terms-list",["jquery","awpcp/settings"],function(a,b){var c=function(b){this.container=b,this.state={allPaymentTerms:this.container.find(".awpcp-payment-terms-list-payment-term")},a.subscribe("/category/updated",_.bind(this.onCategoriesUpdated,this)),a.subscribe("/user/updated",_.bind(this.onUserUpdated,this))};return a.extend(c.prototype,{onCategoriesUpdated:function(c,d,e){a.contains(d.closest("form").get(0),this.container.get(0))&&(null!==e||b.get("hide-all-payment-terms-if-no-category-is-selected"))&&(a.isArray(e)?this.state.selectedCategories=e:this.state.selectedCategories=[e],this.update())},onUserUpdated:function(a,b){this.state.userPaymentTerms=b.payment_terms,this.update()},update:function(){var a=this._getDisabledPaymentTerms(),b=this.state.allPaymentTerms.not(a.get());if(0===b.find(":radio:checked").length){var c=b.eq(0).find(":radio:first");c.prop?c.prop("checked",!0):c.attr("checked","checked")}b.fadeIn(),a.fadeOut()},_getDisabledPaymentTerms:function(){var c=this;return null==c.state.selectedCategories&&b.get("hide-all-payment-terms-if-no-category-is-selected")?c.state.allPaymentTerms:c.state.allPaymentTerms.filter(function(){var b=a(this);return c.state.userPaymentTerms&&!c._isUserPaymentTerm(b)?!0:c.state.selectedCategories&&!c._isPaymentTermAvailableForCategories(b)?!0:!1})},_isUserPaymentTerm:function(b){return-1!==a.inArray(b.attr("data-id"),self.state.userPaymentTerms)},_isPaymentTermAvailableForCategories:function(b){var c=a.parseJSON(b.attr("data-categories"));return a.isArray(c)&&0!==c.length?(c=a.map(c,function(a){return parseInt(a,10)}),0===_.difference(this.state.selectedCategories,c).length):!0}}),c}),AWPCP.define("awpcp/thumbnails-generator",["jquery","awpcp/settings"],function(a,b){var c=0,d=1,e=function(e){function f(a,b){b.type.match("video.*")&&(n.queue.push({video:b,thumbnail:null}),g())}function g(){n.status===c&&(setTimeout(h,100),n.status=d)}function h(){var a=n.video.get(0);return n.index<n.queue.length?(n.currentItem=n.queue[n.index],n.index=n.index+1,a.src=URL.createObjectURL(n.currentItem.video.getNative()),a.play(),void 0):(n.status=c,void(a.src=null))}function i(){var b=this;a.isNumeric(b.duration)&&!isNaN(b.duration)&&Math.abs(b.currentTime-b.duration/2)>1&&(b.currentTime=b.duration/2,b.pause())}function j(){n.currentItem.thumbnail=k(),setTimeout(h,100)}function k(){var a,b=n.video.get(0),c=n.canvas.get(0);return c.width=b.clientWidth,c.height=b.clientHeight,a=c.getContext("2d"),a.drawImage(b,0,0,c.width,c.height),c.toDataURL()}function l(b,c,d){var e=null;a.each(n.queue,function(a,b){b.video.id===c.id&&(e=b.thumbnail)}),null!==e&&m(c,d,e)}function m(c,d,e){a.post(b.get("ajaxurl"),{action:"awpcp-upload-generated-thumbnail",nonce:n.element.attr("data-nonce"),file:d.id,thumbnail:e},function(b){"ok"===b.status&&a.publish("/file/thumbnail-updated",[c,d,b.thumbnailUrl])})}var n=this;n.element=a(e),n.video=n.element.find("video"),n.canvas=n.element.find("canvas"),n.queue=[],n.index=0,n.status=c,"undefined"!=typeof n.video.get(0).canPlayType&&"undefined"!=typeof URL&&"undefined"!=typeof URL.createObjectURL&&(a.subscribe("/file/added",f),a.subscribe("/file/uploaded",l),n.video.bind("canplay",i),n.video.bind("seeked",j))};return e}),AWPCP.define("awpcp/user-information-updater",["jquery"],function(a){var b=function(a){var b=this;b.container=a,b.name=b.container.find("input[name=ad_contact_name]"),b.email=b.container.find("input[name=ad_contact_email]"),b.website=b.container.find("input[name=websiteurl]"),b.phone=b.container.find("input[name=ad_contact_phone]"),b.state=b.container.find("input[name=ad_state], select[name=ad_state]"),b.city=b.container.find("input[name=ad_city], select[name=ad_city]")};return a.extend(b.prototype,{watch:function(){var b=this;a.subscribe("/user/updated",function(a,c,d){b.update(c,d)})},update:function(b,c){var d,e,f=this,g={};d={name:f.name.val(),email:f.email.val(),website:f.website.val(),phone:f.phone.val(),state:f.state.val(),city:f.city.val()},e={name:b.display_name,email:b.user_email,website:b.user_url,phone:b.phone,state:b.state,city:b.city},a.each(d,function(a){d[a]&&d[a].length>0&&!c?g[a]=d[a]:g[a]=e[a]?e[a]:""}),f.name.val(g.name),f.email.val(g.email),f.website.val(g.website),f.phone.val(g.phone),this.city.one("awpcp-update-region-options-completed",function(){f.city.val(g.city).change()}),this.state.val(g.state).change()}}),b}),AWPCP.define("awpcp/multiple-value-selector-delegate",["jquery","awpcp/value-selector","awpcp/value-selector-delegate","awpcp/util/guid"],function(a,b,c,d){var e=function(b,c){var d=this;this.container=b,this.name=c.name,this.multistep=c.multistep,this.maxNumberOfSelectors=3,this.messages={"selected-value-not-allowed":"No payment terms are avaiable for the selected categories. Please change the selected category in this field to see other options."},this.allCategories=c.categories,this.categoriesParents=this._buildCategoriesParentsHierarchy(c.categories),this.availabilityMatrix=void 0,this.prepareSelectors(c.selected),setTimeout(function(){d.broadcastSelectedValue()},100),a.subscribe("/category-selector/set-availability-matrix",function(a,b){d.availabilityMatrix=b}),a.publish("/category-selector/ready")};return a.extend(e.prototype,{_buildCategoriesParentsHierarchy:function(a){
var b={};for(var c in a)if(a.hasOwnProperty(c))for(var d=0;d<a[c].length;d++)"root"==c?b[a[c][d].term_id]=c:b[a[c][d].term_id]=parseInt(c,10);return b},prepareSelectors:function(a){this.selectors=[],this.selected={},this.errors={},0==a.length&&a.push([]);for(var b=0;b<a.length;b++)this._addSelector(a[b].slice())},_addSelector:function(a){var b="vs-"+d.generate();this.selectors.push(b),this.selected[b]=a},getSelectors:function(){return this.selectors},getContainerElement:function(){if(!this.container.is(".awpcp-multiple-value-selector")){var b=this.container;this.container=a('<div class="awpcp-multiple-value-selector"><ul class="awpcp-value-selector-list awpcp-clearfix"></ul><span class="awpcp-value-selector-add-button-placeholder"></span></div>'),b.replaceWith(this.container)}return this.container},getSelectorElement:function(){return a("<li>")},getViewModelForSelector:function(a,d,e){return new b(new c(e,{id:d,name:this.name,label:"Ad Category",categories:this._filterCategories(this.selected[d],this.allCategories),selected:this.selected[d],multistep:this.multistep,shouldShowRemoveButton:this.shouldShowRemoveButton(),errors:this.errors[d]}))},_filterCategories:function(a,b){var c,d=this._getAllSelectedValues(),e={};1==a.length&&(a=this._getCategoriesHierarchy(a));for(var f in b)if(b.hasOwnProperty(f)){e[f]=[];for(var g=0;g<b[f].length;g++)if(c=b[f][g],-1!==a.indexOf(c.term_id))e[f].push(c);else{if(-1!==d.indexOf(c.term_id))continue;e[f].push(c)}0===e[f].length&&delete e[f]}return e},_getAllSelectedValues:function(){for(var a,b=[],c=0;c<this.selectors.length;c++)a=this.selected[this.selectors[c]],a.length&&b.push(a[a.length-1]);return b},_getCategoriesHierarchy:function(a){for(var b,c=[],d=0;d<a.length;d++){b=a[d];do-1===c.indexOf(b)&&c.push(b),b=this.categoriesParents[b];while(b&&"root"!=b)}return c},_getSelectorErrors:function(a,b){return"undefined"==typeof b?[]:0==a.length?[]:-1!==b.indexOf(a[a.length-1])?[]:[this.messages["selected-value-not-allowed"]]},shouldShowAddButton:function(){return this.selectors.length>=this.maxNumberOfSelectors?!1:!0},onAddButtonPressed:function(a){this._addSelector([]),a.render()},shouldShowRemoveButton:function(){return this.selectors.length>1},onRemoveButtonPressed:function(a,b){var c=this.selectors.indexOf(b);-1!==c&&(this.selectors.splice(c,1),delete this.selected[c]),a.render()},valueChangedInSelector:function(a,b,c,d){this._validateSelectedValues(b),a.render(),this.broadcastSelectedValue()},_validateSelectedValues:function(a){var b=this._getAllSelectedValues(),c=this._getAllowedCategories(b,this.selected[a]);this.errors[a]=this._getSelectorErrors(this.selected[a],c)},_getAllowedCategories:function(a,b){var c,d=this.availabilityMatrix,e=_.difference(a,b);return 0==e.length?void 0:"undefined"==typeof d?void 0:_.reduce(e,function(a,b){return c=d[b],"undefined"==typeof c?[]:null===a?c:_.intersection(a,c)},null)},broadcastSelectedValue:function(){var b=this.getContainerElement(),c=this._getAllSelectedValues();a.publish("/category/updated",[b,c])}}),e}),AWPCP.define("awpcp/multiple-value-selector",["jquery"],function(a){var b=function(a){this.delegate=a,this.selectors=this.delegate.getSelectors()};return a.extend(b.prototype,{render:function(){var b,c,d,e,f,g=this;b=this.delegate.getContainerElement(this),b.off("click.mvs change.mvs"),c=b.find(".awpcp-value-selector-list"),c.empty();for(var h=0;h<this.selectors.length;h++)d=this.selectors[h],e=e=this.delegate.getSelectorElement(this,d),e.attr("data-value-selector",d),f=this.delegate.getViewModelForSelector(this,d,e),f.render(),c.append(e);var i=b.find(".awpcp-value-selector-add-button");0===i.length&&(i=a('<a href="#" class="awpcp-value-selector-button awpcp-value-selector-add-button" title="Add Another Category">Add Another Category</a>'),b.find(".awpcp-value-selector-add-button-placeholder").replaceWith(i)),this.delegate.shouldShowAddButton()?i.show():i.hide(),b.on("click.mvs",".awpcp-value-selector-add-button",function(a){a.preventDefault(),g.delegate.onAddButtonPressed(g)}),b.on("click.mvs",".awpcp-value-selector-remove-button",function(b){b.preventDefault();var c=a(b.target).closest("[data-value-selector]").attr("data-value-selector");g.delegate.onRemoveButtonPressed(g,c)}),b.on("change.mvs",".awpcp-value-selector-control",{},function(a){return console.log("change.mvs"),g.onValueChanged(a),!0})},onValueChanged:function(b){var c=a(b.target),d=c.attr("id"),e=d.substr(0,d.lastIndexOf("-"));this.delegate.valueChangedInSelector(this,e,c,b),this.delegate.getContainerElement().find("#"+d).focus()}}),b}),AWPCP.define("awpcp/value-selector-delegate",["jquery"],function(a){var b=function(a,b){var c=Math.max(0,b.selected.length-1);this.container=a,this.id=b.id,this.name=b.name,this.label=b.label,this.categories=b.categories,this.selected=b.selected,this.multistep=b.multistep,this.errors=b.errors,this._shouldShowRemoveButton=b.shouldShowRemoveButton,this._updateSelectorSteps(c,this.selected[c])};return a.extend(b.prototype,{getSteps:function(a){return this.steps},getContainerElement:function(b){if(0===this.container.find(".awpcp-value-selector-steps-list").length){var c=this.id+"-0",d=this.label;this.container.append(a('<label for="'+c+'" class="awpcp-value-selector-label">'+d+"</label>")),this.container.append(a('<span class="awpcp-value-selector-remove-button-placeholder"></span>')),this.container.append(a('<ul class="awpcp-value-selector-steps-list clearfix"></ul>')),this.container.append(a('<div class="awpcp-value-selector-errors"></div>'))}return this.container},getStepElement:function(b,c){var d=a('<li class="awpcp-value-selector-step"></li>'),e=this.id+"-"+c,f=this.name+"["+this.id+"][]";return d.append('<select id="'+e+'" class="awpcp-value-selector-control" name="'+f+'"></select>'),d},getOptionsForStep:function(a,b){return this.multistep?this._getOptionsForStep(a,b):this._getAllOptions()},_getOptionsForStep:function(a,b){var c=0==b?"root":this.selected[b-1];categories=this._getCategoryChildren(c),options=[{name:this._getPlaceholderForStep(b),value:0}];for(var d=0;d<categories.length;d++)options.push({name:categories[d].name,value:categories[d].term_id});return options},_getAllOptions:function(){return categories=this._getCategoryChildren("root"),options=[{name:this._getPlaceholderForStep(0),value:0}],this._prepareOptions(categories,options,0)},_prepareOptions:function(a,b,c){for(var d,e,f=0;f<a.length;f++)d=a[f].term_id,e=this._getCategoryChildren(d),prefix="&mdash;&nbsp;".repeat(c),b.push({name:prefix+a[f].name,value:d}),this._prepareOptions(e,b,c+1);return b},_getPlaceholderForStep:function(a){var b=Math.min(a,1);return{0:"Select a Category",1:"Select a Sub-category"}[b]},getSelectedValueForStep:function(a,b){return this.selected[b]},valueChangedInStep:function(a,b,c,d){this._updateSelectorSteps(b,c.val())},_updateSelectorSteps:function(a,b){b=parseInt(b,10),b?this.selected.splice(a,this.selected.length-a,b):this.selected.splice(a),this.multistep?this._getCategoryChildren(this.selected[a]).length?this.steps=this.selected.length+1:this.steps=Math.max(1,this.selected.length):this.steps=1},_getCategoryChildren:function(a){return"undefined"!=typeof this.categories[a]?this.categories[a]:[]},shouldShowRemoveButton:function(a){return this._shouldShowRemoveButton},getErrorMessages:function(){return this.errors}}),b}),AWPCP.define("awpcp/value-selector",["jquery"],function(a){var b=function(a){this.delegate=a};return a.extend(b.prototype,{render:function(){var b,c,d,e,f=this,g=this.delegate.getContainerElement(this);g.find(".awpcp-value-selector-step").remove(),g.off("change.vs");for(var h=0;h<this.delegate.getSteps();h++){b=this.delegate.getStepElement(this,h),c=b.find(".awpcp-value-selector-control"),d=this.delegate.getOptionsForStep(this,h),selected=this.delegate.getSelectedValueForStep(this,h);for(var i in d)d.hasOwnProperty(i)&&(e=a("<option>").prop("value",d[i].value).html(d[i].name),d[i].value==selected&&e.prop("selected",!0),c.append(e));c.attr("data-value-selector-step",h),g.find(".awpcp-value-selector-steps-list").append(b)}var j=this.delegate.getErrorMessages(),k=g.find(".awpcp-value-selector-errors").empty();_.each(j,function(b){k.append(a("<p>"+b+"</p>"))});var l=g.find(".awpcp-value-selector-remove-button");0===l.length&&(l=a('<a href="#" class="awpcp-value-selector-button awpcp-value-selector-remove-button dashicons-before dashicons-no" title="Remove Category"></a>'),g.find(".awpcp-value-selector-remove-button-placeholder").replaceWith(l)),this.delegate.shouldShowRemoveButton(this)?l.show():l.hide(),g.on("change.vs",".awpcp-value-selector-control",{},function(a){return f.onValueChanged(a),!0})},addStep:function(){var a=this.steps[this.steps.length-1];this.steps.append(a+1),this.render()},removeStep:function(a){var b=this.steps.indexOf(a);-1!==b&&this.steps.splice(b,1),this.render()},onValueChanged:function(b){var c=a(b.target),d=parseInt(c.attr("data-value-selector-step"),10);this.delegate.valueChangedInStep(this,d,c,b)}}),b}),AWPCP.define("awpcp/util/guid",[],function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return{generate:function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}}),AWPCP.define("awpcp/util/number-format",["awpcp/settings"],function(a){var b={format:function(b,c,d,e){var f,g,c=isNaN(c=Math.abs(c))?2:c,e=void 0==e?".":a.get("decimal-separator"),d=void 0==d?",":a.get("thousands-separator");return absolute=Math.abs(+b||0).toFixed(c),f=parseInt(absolute,10).toString(),firstThousandsGroupPosition=f.length>3?f.length%3:0,g=firstThousandsGroupPosition?f.substr(0,firstThousandsGroupPosition):"",g+=f.substr(firstThousandsGroupPosition).replace(/(\d{3})(?=\d)/g,"$1"+d),c&&(g+=e+Math.abs(absolute-f).toFixed(c).slice(2)),b>=0?g:"("+g+")"}};return b}),AWPCP.define("awpcp/asynchronous-tasks",["jquery","knockout","moment","awpcp/settings"],function(a,b,c,d){function e(a){this.name=b.observable(a.name),this.action=a.action,this.recordsCount=b.observable(a.recordsCount||null),this.recordsLeft=b.observable(a.recordsLeft||null),this.startTime=b.observable(null),this.lastUpdated=b.observable(null),this.progress=b.computed(function(){var a,b=this.recordsCount(),c=this.recordsLeft();return null===c||null===b?a=0:0===c?a=100:b>0&&(a=100*(b-c)/b),a=Math.round(100*a)/100,""+a+"%"},this).extend({throttle:1}),this.remainingTime=b.computed(function(){var a=new Date,b=null;return function(){var d,e,f,g=this.startTime(),h=this.lastUpdated(),i=parseFloat(this.progress()),j=new Date;return 2500>j-a?b:null===g||null===h?null:0===i?null:(d=100-i,e=h-g,f=d*e/i/1e3,a=j,b=f>0?c(j).add(f,"seconds").from(j,!0):null)}}(),this)}function f(c,d){this.working=b.observable(!1),this.message=b.observable(!1),this.error=b.observable(!1),this.texts={},a.each(d,a.proxy(function(a,c){this.texts[a]=b.observable(c)},this)),this.tasks=b.observableArray([]),a.each(c,a.proxy(function(a,b){this.tasks.push(new e(b))},this)),this.tasksCount=this.tasks().length,this.currentTaskIndex=b.observable(0),this.tasksCompleted=b.observable(0),this.tasksLeft=b.computed(function(){return this.tasksCount-this.tasksCompleted()},this),this.completed=b.observable(0===this.tasksLeft()),this.progress=b.computed(function(){var a,b,c=this.tasks(),d=c[this.currentTaskIndex()],e=this.tasksCompleted();return a=d?parseFloat(d.progress())/100:0,b=this.working()?100*(e+a)/this.tasksCount:100*e/this.tasksCount,b+"%"},this).extend({throttle:1})}return b.bindingHandlers.progress={init:function(b,c){var d=c();a(b).animate({width:d()})},update:function(b,c){var d=c();a(b).animate({width:d()})}},a.extend(f.prototype,{render:function(c){b.applyBindings(this,a(c).get(0))},start:function(){this.working(!0),setTimeout(a.proxy(this.runTask,this),1)},runTask:function(){var b,c=this.tasks();this.currentTaskIndex()>=this.tasksCount?(this.working(!1),this.completed(!0)):(b=c[this.currentTaskIndex()],null===b.startTime()&&b.startTime(new Date),a.getJSON(d.get("ajaxurl"),{action:b.action},a.proxy(this.handleAjaxResponse,this)))},handleAjaxResponse:function(a){"ok"===a.status?this.handleSuccessfulResponse(a):this.handleErrorResponse(a)},handleSuccessfulResponse:function(b){var c=this.tasks(),d=c[this.currentTaskIndex()];b.message&&this.showMessage(b.message),d.recordsCount(d.recordsCount()||parseInt(b.recordsCount,10)),d.recordsLeft(parseInt(b.recordsLeft,10)),d.lastUpdated(new Date),0===d.recordsLeft()&&(this.tasksCompleted(this.tasksCompleted()+1),this.currentTaskIndex(this.currentTaskIndex()+1)),setTimeout(a.proxy(this.runTask,this),1)},showMessage:function(a){this.clearMessagesAndErrors(),this.message(a)},clearMessagesAndErrors:function(){this.message(!1),this.error(!1)},handleErrorResponse:function(a){this.showError(a.error)},showError:function(a){this.clearMessagesAndErrors(),this.error(a)}}),f}),AWPCP.define("awpcp/collapsible",["jquery"],function(a){function b(a){this.element=a,this.handler=this.element.find(".js-handler").eq(0),this.subject=this.element.find("[data-collapsible]").eq(0)}return a.extend(b.prototype,{setup:function(){var a=this;0!==a.subject.length?(a.subject.is("[awpcp-keep-open]")||a.subject.hide(),a.toggleHandlerClass(),a.handler.click(function(b){a.toggle.apply(a,[b,this])})):a.handler.hide()},toggleHandlerClass:function(){this.subject.is(":visible")?this.handler.find("span").removeClass("open").addClass("close"):this.handler.find("span").removeClass("close").addClass("open")},toggle:function(a){a.preventDefault();var b=this;b.subject.slideToggle(function(){b.toggleHandlerClass()})}}),b}),AWPCP.define("awpcp/localization",["jquery"],function(a){return{get:function(b,c){return a.AWPCP.l10n(b,c)}}}),AWPCP.define("awpcp/settings",["jquery"],function(a){return a.AWPCP}),AWPCP.define("awpcp/users-autocomplete",["jquery","awpcp/settings"],function(a,b){function c(b){var c=this;c.field=a(b),c.hidden=c.field.siblings("[autocomplete-selected-value]"),c.previous_value=null}return a.extend(c.prototype,{setup:function(){var c=this,d=b.get("users-autocomplete-default-user");c.field.autocomplete({source:function(c,d){a.getJSON(b.get("ajaxurl"),{action:"awpcp-autocomplete-users",term:c.term},function(a){"ok"===a.status&&d(a.items)})},select:function(a,b){b.item&&c.update(b.item)}}),d&&c.init(d)},init:function(b){var c=this;c.hidden.val(b.ID),c.field.val(b.public_name),c.previous_value=parseInt(c.hidden.val(),10),a.publish("/user/updated",[b,!1])},update:function(b){var c,d=this;d.hidden.val(b.ID),d.field.val(b.public_name),d.previous_value=parseInt(d.hidden.val(),10),c=b.ID!==d.previous_value,a.publish("/user/updated",[b,c])}}),c}),AWPCP.define("awpcp/users-dropdown",["jquery"],function($){function UsersDropdown(a){var b=this;b.field=$(a),b.previous_value=null}return $.extend(UsersDropdown.prototype,{setup:function(){var a=this,b=a.getSelectedUserId();a.field.change(function(){a.getSelectedUserId()>0?a.update(a.getSelectedUser()):a.previous_value=0}),b>0&&a.init(a.getSelectedUser())},getSelectedUserId:function(){return parseInt(this.field.val(),10)},getSelectedUser:function(){var user_information=this.field.find(":selected").attr("data-user-information");return user_information&&$.parseJSON?$.parseJSON(user_information):user_information?eval("("+user_information+")"):null},init:function(a){this.previous_value=a.ID,$.publish("/user/updated",[a,!1])},update:function(a){var b=this.previous_value!==a.ID;$.publish("/user/updated",[a,b]),this.previous_value=a.ID}}),UsersDropdown}),AWPCP.define("awpcp/jquery-userfield",["jquery","awpcp/users-dropdown","awpcp/users-autocomplete"],function(a,b,c){a.fn.userfield=function(){return a(this).each(function(){var d,e=a(this);e.is("[dropdown-field]")?d=new b(e):e.is("[autocomplete-field]")&&(d=new c(e)),d.setup()})}}),AWPCP.define("awpcp/jquery-collapsible",["jquery","awpcp/collapsible"],function(a,b){a.fn.collapsible=function(){return a(this).each(function(){var c=new b(a(this));c.setup()})}}),AWPCP.define("awpcp/jquery-validate-methods",["jquery"],function(a){return a(function(){"undefined"!=typeof a.validator&&(a.validator.addMethod("oneof",function(b,c,d){return this.optional(c)?!0:-1!==a.inArray(b,d)?!0:!1}),a.validator.addMethod("classifiedsurl",function(a,b){return this.optional(b)||/^(?:(https?|s?ftp):\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)}))}),!0}),AWPCP.run("awpcp/init-collapsible-elements",["jquery","awpcp/jquery-collapsible"],function(a){a(function(){a(".awpcp-categories-list .top-level-category").closest("li").collapsible()})}),AWPCP.run("awpcp/init-categories-dropdown",["jquery","awpcp/category-dropdown"],function(a){a(function(){a(".awpcp-category-dropdown").categorydropdown()})}),AWPCP.run("awpcp/init-recaptcha",["jquery"],function(a){var b=45,c=0,d=1500,e=!1,f=function(){c+=1,"undefined"!=typeof grecaptcha?g():b>=c&&(e=setTimeout(f,d*Math.pow(c/b,2)))},g=function(){a(".awpcp-recaptcha").each(function(){var b=a(this);b.data("awpcp-recaptcha")||(grecaptcha.render(this,{sitekey:b.attr("data-sitekey"),theme:"light"}),b.data("awpcp-recaptcha",!0))})};window.AWPCPreCAPTCHAonLoadCallback=function(){e&&clearTimeout(e),g()},a(f)});